@model MapLab.Shared.Models.Emails.ErrorViewModel
@{
    Layout = null;
}

<h1>Server Error Notification</h1>
<p>An error occurred on the server that requires your attention.</p>

<div class="alert alert-danger">
    <h3>Error: @Model.ErrorMessage</h3>
    <p><strong>Time:</strong> @Model.TimeOccured.ToString("yyyy-MM-dd HH:mm:ss")</p>
    <p><strong>Status Code:</strong> <span class="badge bg-danger">@Model.StatusCode</span></p>
</div>

<div class="card">
    <div class="card-header">Request Details</div>
    <div class="card-body">
        <table class="table">
            <tr>
                <th>Request ID</th>
                <td><code>@Model.RequestId</code></td>
            </tr>
            <tr>
                <th>URL</th>
                <td>@Model.RequestUrl</td>
            </tr>
            <tr>
                <th>Method</th>
                <td>@Model.RequestMethod</td>
            </tr>
            <tr>
                <th>User IP</th>
                <td>@Model.UserIpAddress</td>
            </tr>
            <tr>
                <th>User</th>
                <td>@(string.IsNullOrEmpty(Model.Username) ? "Anonymous" : Model.Username)</td>
            </tr>
            <tr>
                <th>User Agent</th>
                <td class="text-secondary text-monospace">@Model.UserAgent</td>
            </tr>
        </table>
    </div>
</div>

<div class="card">
    <div class="card-header">Exception Details</div>
    <div class="card-body">
        <h4>@Model.ExceptionType</h4>
        <div class="border-left">
            <p>@Model.ExceptionMessage</p>
        </div>

        @if (!string.IsNullOrEmpty(Model.StackTrace))
        {
            <h5>Stack Trace</h5>
            <pre class="text-monospace">
                @Model.StackTrace
                </pre>
        }

        @if (!string.IsNullOrEmpty(Model.InnerException))
        {
            <h5>Inner Exception</h5>
            <div class="border-left">
                <p>@Model.InnerException</p>

                @if (!string.IsNullOrEmpty(Model.StackTrace))  // Adjust this based on InnerException's StackTrace, if available
                {
                    <pre class="text-monospace">
                        @Model.StackTrace
                            </pre>
                }
            </div>
        }

        <p>
            <strong>Environment:</strong> @Model.Environment<br>
            <strong>Server:</strong> @Model.ApplicationVersion<br>
            <strong>Application Version:</strong> @Model.ApplicationVersion
        </p>

        <p>
            <small>This is an automated notification. Please do not reply to this email.</small>
        </p>
    </div>
</div>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .alert {
        position: relative;
        padding: 1rem;
        margin-bottom: 1rem;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .alert-danger {
        color: #721c24;
        background-color: #f8d7da;
        border-color: #f5c6cb;
    }

    .card {
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 1px solid rgba(0,0,0,.125);
        border-radius: 0.25rem;
        margin-bottom: 1rem;
    }

    .card-header {
        padding: 0.75rem 1.25rem;
        margin-bottom: 0;
        background-color: rgba(0,0,0,.03);
        border-bottom: 1px solid rgba(0,0,0,.125);
        font-weight: bold;
    }

    .card-body {
        padding: 1.25rem;
    }

    .badge {
        display: inline-block;
        padding: 0.25em 0.4em;
        font-size: 75%;
        font-weight: 700;
        line-height: 1;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: 0.25rem;
    }

    .bg-danger {
        background-color: #dc3545 !important;
        color: white;
    }

    .table {
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
        border-collapse: collapse;
    }

        .table th, .table td {
            padding: 0.75rem;
            vertical-align: top;
            border-top: 1px solid #dee2e6;
        }

    .text-monospace {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .text-secondary {
        color: #6c757d;
    }

    .border-left {
        border-left: 3px solid #dee2e6;
        padding-left: 15px;
    }

    pre {
        white-space: pre-wrap;
        margin: 0;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
    }
</style>

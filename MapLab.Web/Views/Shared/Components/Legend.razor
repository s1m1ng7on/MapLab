@using Newtonsoft.Json.Linq
<div class="legend">
    <h3>@Title</h3>
    <ul>
        @foreach (var item in legendItems)
        {
            <li>
                <span style="background-color: @item.Key; padding: 2px 8px; border-radius: 4px;">
                    @item.Value
                </span>
            </li>
        }
    </ul>
</div>

@code {
    [Parameter] public string? Title { get; set; }
    [Parameter] public JObject? Data { get; set; }

    private Dictionary<string, string> legendItems = new();

    protected override void OnParametersSet()
    {
        if (Data == null) return;

        legendItems.Clear();
        var featuresArray = Data["features"] as JArray;
        if (featuresArray == null) return;

        foreach (var feature in featuresArray)
        {
            var properties = feature["properties"];
            if (properties != null)
            {
                var name = properties["name"]?.ToString();
                var fillColor = properties["fill"]?.ToString();

                if (!string.IsNullOrEmpty(name) && !string.IsNullOrEmpty(fillColor) && !legendItems.ContainsKey(fillColor))
                {
                    legendItems[fillColor] = name;
                }
            }
        }
    }
}
